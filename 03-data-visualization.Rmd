# Chapter 3 - Data Visualisation {-}


Load the libraries needed for these exercises.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r library, message=FALSE}
library(tidyverse)
```

## 3.2 - First Steps {-}

### Problem 1 {-}

Run `ggplot(data = mpg)`. What do you see?

We have a blank plot, since we have only constructed the initial plot object 
without any aesthetics.

```{r 3-2-1}
ggplot(data = mpg)
```

### Problem 2 {-}

How many rows are in `mpg`? How many columns?

There are `r nrow(mpg)` rows and `r ncol(mpg)` columns in the `mpg` data set.

```{r 3-2-2}
nrow(mpg)
ncol(mpg)
```

### Problem 3 {-}

What does the `drv` variable describe? Read the help for `?mpg` to find out.

The variable `drv` describes the drive of the vehicle: f = front-wheel drive, 
r = rear wheel drive, 4 = 4wd.

```{r 3-2-3}
?mpg
```

### Problem 4 {-}

Make a scatter plot of `hwy` vs `cyl`.

```{r 3-2-4}
ggplot(mpg, aes(cyl, hwy)) +
  geom_point()
```

### Problem 5 {-}

What happens if you make a scatter plot of `class` vs `drv`? Why is the plot 
not useful?

Since `class` and `drv` are categorical variables, we don't see much of a 
meaningful relationship in the scatter plot.

```{r 3-2-5}
ggplot(mpg, aes(class, drv)) +
  geom_point()
```


## 3.3 - Aesthetic Mappings {-}

### Problem 1 {-}

What’s gone wrong with this code? Why are the points not blue?

```{r 3-3-1a}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = "blue"))
```

To set an aesthetic manually, it must go outside of `aes()`.

```{r 3-3-1b}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy), color = "blue")
```

### Problem 2 {-}

Which variables in mpg are categorical? Which variables are continuous? 
(Hint: type ?mpg to read the documentation for the data set). How can you see 
this information when you run mpg?

We can use the `summary` function to see the mode of each variable.

```{r 3-3-2a}
summary(mpg)
```

Or since the data frame is a tibble, just running `mpg` will show you the 
various variable types.

```{r 3-3-2b}
head(mpg)
```


### Problem 3 {-}

Map a continuous variable to color, size, and shape. How do these aesthetics 
behave differently for categorical vs. continuous variables?

Continuous variables will use a gradient to scale `color` and `size`, but will 
throw an error when applied to shape.

```{r 3-3-3a}
ggplot(data = mpg, mapping = aes(x = cty, y = hwy, color = displ)) + 
  geom_point()
```

```{r 3-3-3b}
ggplot(data = mpg, mapping = aes(x = cty, y = hwy, size = displ)) + 
  geom_point()
```

```{r 3-3-3c, error=FALSE}
p <- ggplot(data = mpg, mapping = aes(x = cty, y = hwy, shape = displ)) + 
  geom_point()
```


### Problem 4 {-}

What happens if you map the same variable to multiple aesthetics?

Mapping `displ` to `color` and `size` results in the following graph. Not 
necessarily helpful, but two ways of displaying the some variation.
```{r 3-3-4}
ggplot(data = mpg, mapping = aes(x = cty, y = hwy, color = displ, size = displ)) + 
  geom_point()
```

### Problem 5 {-}

What does the stroke aesthetic do? What shapes does it work with? 
(Hint: use ?geom_point)

The `stroke` aesthetic will modify the width of the border of a shape. From the 
documentation:

```{r 3-3-5}
ggplot(mtcars, aes(wt, mpg)) +
  geom_point(shape = 21, colour = "black", fill = "white", size = 5, stroke = 5)
```

### Problem 6 {-}

What happens if you map an aesthetic to something other than a variable name, 
like aes(colour = displ < 5)?

In this case the condition we pass to `color` returns a boolean that will map 
to `color`.
```{r 3-3-6}
ggplot(mtcars, aes(wt, mpg, color = disp < 100)) +
  geom_point()
```

## 3.5 - Facets {-}

### Problem 1 {-}

What happens if you facet on a continuous variable?

The `facet_wrap` feature will still produce plots for each unique value.

```{r 3-5-1}
ggplot(mtcars, aes(disp, mpg)) +
  geom_point() +
  facet_wrap(~ wt)
```

### Problem 2 {-}

What do the empty cells in plot with `facet_grid(drv ~ cyl)` mean? How do they 
relate to this plot?

Empty cells occur when there are no observations within a specific combination 
of facet variables. We see in the below plot that there are no vehicles with 4wd 
and 5 cylinders.

```{r 3-5-2}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = drv, y = cyl))
```

### Problem 3 {-}

What plots does the following code make? What does `.` do?

In the first example, using `.` allows us to plot a `facet_grid` without a 
column variable.
```{r 3-5-3a}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_grid(drv ~ .)
```

This is easier than trying to hack together a similar plot using `facet_wrap`.
```{r 3-5-3b}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_wrap(~ drv, nrow = n_distinct(mpg$drv))
```

We can also use `.` to make a `facet_grid` while omitting a row variable.

```{r 3-5-3c}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_grid(. ~ cyl)
```

### Problem 4 {-}

Take the first faceted plot in this section. What are the advantages to using 
faceting instead of the colour aesthetic? What are the disadvantages? How might 
the balance change if you had a larger dataset?

Faceting can make it easier to see the variation by `class` than using the color 
aesthetic, but can be unwieldy when the number of distinct values in `class` is 
large. For a larger dataset, faceting may be necessary, as the increased number 
of points may make it difficult to see a variation by color.

```{r 3-5-4}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) + 
  facet_wrap(~ class, nrow = 2)
```

### Problem 5 {-}

Read ?facet_wrap. What does nrow do? What does ncol do? What other options 
control the layout of the individual panels? Why doesn’t facet_grid() have nrow 
and ncol arguments?

The `nrow` and `ncol` arguments allow you to control the number of rows or 
columns in the panel. There are a number of other arguments in `facet_wrap`:
  * `scales`: can fix scales or allow them to vary
  * `shrink`: shrink scales to fit output of statistics, not raw data
  * `labeller`: takes one data frame of labels and returns a list or data frame of character vectors
  * `as.table`: display facets as a table or a plot
  * `switch`: flip the labels
  * `drop`: drop unused factor lebels
  * `dir`: control direction of the panel
  * `strip.position`: control where to place the labels

The `facet_grid` function has `nrow` and `ncol` predefined by the faceting variables.

### Problem 6 {-}

When using facet_grid() you should usually put the variable with more unique 
levels in the columns. Why?

This will expand your panel vertically, making it easier to scroll through 
the grid.

```{r 3-5-6a}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_grid(trans ~ drv)
```

```{r 3-5-6b}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_grid(drv ~ trans)
```

## 3.6 - Geometric Objects {-}

### Problem 1 {-}

What geom would you use to draw a line chart? A boxplot? A histogram? An area 
chart?

Use `geom_line` to draw a line chart.

```{r 3-6-1a}
ggplot(economics, aes(date, unemploy)) + 
  geom_line()
```

Use `geom_boxplot` to create a boxplot.

```{r 3-6-1b}
ggplot(mpg, aes(x = class, y = hwy)) +
  geom_boxplot()
```

Use `geom_histogram` to create a histogram.

```{r 3-6-1c}
ggplot(mpg, aes(x = hwy)) +
  geom_histogram()
```

And use `geom_area` to create an area chart.

```{r 3-6-1d}
ggplot(economics, aes(date, unemploy)) + 
  geom_area()
```

### Problem 2 {-}

Run this code in your head and predict what the output will look like. Then, 
run the code in R and check your predictions.

Be sure to think through the initial `ggplot` call and consider what will be 
passed to `geom_point` and `geom_smooth`.

```{r 3-6-2}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = drv)) + 
  geom_point() + 
  geom_smooth(se = FALSE)
```

### Problem 3 {-}

What does `show.legend = FALSE` do? What happens if you remove it? Why do you 
think I used it earlier in the chapter?

The `show.legend` argument will can be used to map a layer to a legend. Setting 
to `FALSE` will remove that layer from the plot. 

```{r 3-6-3a}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = drv)) + 
  geom_point(show.legend = FALSE) +
  geom_smooth(se = FALSE, show.legend = FALSE)
```

But note that this only works by geom.
```{r 3-6-3b}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = drv)) + 
  geom_point(show.legend = FALSE) + 
  geom_smooth(se = FALSE)
```

### Problem 4 {-}

What does the `se` argument to `geom_smooth()` do?

The `se` argument controls whether a confidence band is displayed around smooth. 
Note that the argument is set to `TRUE` by default.

```{r 3-6-4a}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = drv)) + 
  geom_point(show.legend = FALSE) + 
  geom_smooth()
```

The `level` argument is used to control the confidence interval, and is set to 
0.95 by default.

```{r 3-6-4b}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = drv)) + 
  geom_point(show.legend = FALSE) + 
  geom_smooth(level = 0.9999)
```

### Problem 5 {-}

Will these two graphs look different? Why/why not?

The graphs should look the same, as `data` and `aes` are inherited by 
`geom_point()` and `geom_smooth()` in the first example.

```{r 3-6-5a}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point() + 
  geom_smooth()
```

```{r 3-6-5b}
ggplot() + 
  geom_point(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_smooth(data = mpg, mapping = aes(x = displ, y = hwy))
```

### Problem 6 {-}

Recreate the R code necessary to generate the following graphs.

```{r 3-6-6a}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point() + 
  geom_smooth(se = FALSE)
```

```{r 3-6-6b}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy, grp = drv)) + 
  geom_point() + 
  geom_smooth(se = FALSE)
```

```{r 3-6-6c}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = drv)) + 
  geom_point() + 
  geom_smooth(se = FALSE)
```

```{r 3-6-6d}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point(aes(color = drv)) + 
  geom_smooth(se = FALSE)
```

```{r 3-6-6e}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point(aes(color = drv)) + 
  geom_smooth(aes(linetype = drv), se = FALSE)
```

```{r 3-6-6f}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = drv)) + 
  geom_point()
```

## 3.7 - Statistical Transformations {-}

### Problem 1 {-}

What is the default geom associated with `stat_summary()`? How could you rewrite
the previous plot to use that geom function instead of the stat function?

The default geom associated with `stat_summary()` is `pointrange`. We can 
recreate the last plot using:

```{r 3-7-1}
ggplot(data = diamonds) + 
  geom_pointrange(
    mapping = aes(x = cut, y = depth),
    stat = 'summary',
    fun.ymin = min,
    fun.ymax = max,
    fun.y = median
  )
```

### Problem 2 {-}

What does `geom_col()` do? How is it different to `geom_bar()`?

From the `ggplot2` documentation: `geom_bar()` makes the height of the bar 
proportional to the number of cases in each group, while `geom_col()` will map
directly to the data.

We can make a simple bar chart using `geom_bar` which will transform the data 
under the hood:

```{r 3-7-2a}
ggplot(mpg, aes(class)) + 
  geom_bar()
```

Or do the transformation ourselves and map directly using `geom_col`:

```{r 3-7-2b}
mpg %>%
  group_by(class) %>%
  count() %>%
  ggplot(aes(class, n)) +
  geom_col()
```

### Problem 3 {-}

Most geoms and stats come in pairs that are almost always used in concert. 
Read through the documentation and make a list of all the pairs. 
What do they have in common?

Some examples from the `ggplot2` documentation includes:

* `geom_bar` --> `stat_count`
* `geom_bin2d` --> `stat_bin_2d`
* `geom_boxplot` --> `stat_boxplot`
* `geom_contour` --> `stat_contour`
* `geom_count` --> `stat_sum`
* `geom_density` --> `stat_density`
* `geom_density_2d` --> `stat_density_2d`
* `geom_histogram` --> `stat_bin`
* `geom_hex` --> `stat_bin_hex`

### Problem 4 {-}

What variables does `stat_smooth()` compute? What parameters control its behavior?

`stat_smooth` computes the following:
  * y the predicted value
  * ymin - lower pointwise confidence interval around the mean
  * ymax - upper pointwise confidence interval around the mean
  * se - standard error
  
The behaviour of `stat_smooth` can be controled using:
  * `method` to adjust the smoothing method used
  * `formula` to adjust the smoothing formula used
  * `span` to adjust the amount of smoothing
  * `level` to set the confidence level used
  
### Problem 5 {-}

In our proportion bar chart, we need to set group = 1. Why? In other words 
what is the problem with these two graphs?

The first chart displays a proportion = 1 for all groups.
```{r 3-7-5a}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, y = ..prop..))
```

While the second plot does something similar, multiplied by the number of 
categories in `color`.

```{r 3-7-5b}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = color, y = ..prop..))
```

`geom_bar()` will compute `prop` - the groupwise proportion. So we must pass in 
an argument to `group` for `prop` to be calculated properly.

```{r 3-7-5c}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, y = ..prop.., group = 1))
```

```{r 3-7-5d}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, y = ..prop.., fill = color, group = color))
```

## 3.8 - Position Adjustments {-}

### Problem 1 {-}

What is the problem with this plot? How could you improve it?

```{r 3-8-1a}
ggplot(data = mpg, mapping = aes(x = cty, y = hwy)) + 
  geom_point()
```

Use `geom_jitter()` to correct the overplotting in the original.

```{r 3-8-1b}
ggplot(data = mpg, mapping = aes(x = cty, y = hwy)) + 
  geom_jitter()
```

### Problem 2 {-}

What parameters to geom_jitter() control the amount of jittering?

The `width` and `height` arguments control the amount of jittering and defaults 
to 40% of the resolution of the data.

So values less than 0.4 will make a graph more compact than the default `geom_jitter()`

```{r 3-8-2a}
ggplot(data = mpg, mapping = aes(x = cty, y = hwy)) + 
  geom_jitter(width = 0.20, height = 0.20)
```

While values greater than 0.4 will make a smoother graph.

```{r 3-8-2b}
ggplot(data = mpg, mapping = aes(x = cty, y = hwy)) + 
  geom_jitter(width = 0.60, height = 0.60)
```

### Problem 3 {-}

Compare and contrast geom_jitter() with geom_count().

`geom_jitter()` and `geom_count` are both useful when dealing with overplotting. 
While `geom_jitter` will add a small amount of noise to each point to spread them 
out, `geom_count` will cont the number of observations at each (x,y) point, and 
then map the count.

`geom_jitter()` is equivalent to `geom_point(position = 'jitter')`
`geom_count()` is equivalent to `geom_point(stat = 'sum')`

```{r 3-8-3}
ggplot(data = mpg, mapping = aes(x = cty, y = hwy)) + 
  geom_count() 
```

### Problem 4 {-}

What’s the default position adjustment for `geom_boxplot()`? Create a 
visualisation of the mpg dataset that demonstrates it.

The default position adjustment for `geom_boxplot()` is `dodge`.

```{r 3-8-4a}
ggplot(mpg, aes(class, cty, color = drv)) +
  geom_boxplot()
```

```{r 3-8-4b}
ggplot(mpg, aes(x = class, y = cty, color = drv)) +
  geom_boxplot(position = 'identity')
```

## 3.9 - Coordinate Systems {-}

### Problem 1 {-}

Turn a stacked bar chart into a pie chart using `coord_polar()`.

From the documentation for `coord_polar()` we can first make a stacked bar chart:

```{r 3-9-1a}
ggplot(mtcars, aes(x = factor(1), fill = factor(cyl))) +
 geom_bar()
```

And turn it into a pie chart:

```{r 3-9-1b}
ggplot(mtcars, aes(x = factor(1), fill = factor(cyl))) +
  geom_bar(width = 1) +
  coord_polar(theta = 'y')
```

### Problem 2 {-}

What does `labs()` do? Read the documentation.

`labs()` allows you to modify the labels of a plot, axis, or legend.

```{r 3-9-2}
ggplot(mpg, aes(cty, hwy)) +
  geom_point() +
  labs(title = 'Title',
       subtitle = 'Subtitle',
       caption = 'Caption')
```

### Problem 3 {-}

What’s the difference between `coord_quickmap()` and `coord_map()`?

`coord_quickmap` preserves straight lines when projecting onto a two dimensional 
surface and requires less computation.

```{r 3-9-3a}
library(maps)

ggplot(map_data('state'), aes(long, lat, group = group)) +
  geom_polygon(fill = 'white', color = 'black') +
  coord_map()
```

```{r 3-9-3b}
ggplot(map_data('state'), aes(long, lat, group = group)) +
  geom_polygon(fill = 'white', color = 'black') +
  coord_quickmap()
```

### Problem 4 {-}

What does the plot below tell you about the relationship between city and 
highway mpg? Why is `coord_fixed()` important? What does `geom_abline()` do?

`coord_fixed()` (with no arguments) ensures that a unit on the x-axis is the 
same length as a unit on the y-axis. 

`geom_abline()` (with no arguments) adds a reference line with an intercept of 
0 and a slope of 1. We can quickly see that every observation in the `mpg` 
dataset has better highway than city fuel efficiency.

```{r 3-9-4}
ggplot(data = mpg, mapping = aes(x = cty, y = hwy)) +
  geom_point() + 
  geom_abline() +
  coord_fixed()
```


